#canvas

  .imageholder.selected
    .controls
      %button crop both
      %button rotate both
      %button publish both
  .imageholder.instructions
      %h2 drag and drop your images here to share them on facebook...

%section#images
  %article.image
    .slider_container
      #slider
    #drop_box
      .image_box
        Drop your image here
    #rotate
      %p
        Rotate
    #rotate_all
      %p
        Rotate all
:javascript
  $(function() {
    $("#images").dndUploader({
      url : "/upload"
    });

  function updateImage(image) {
    $("#drop_box").append("<img src='"+image.image+"' />");
  }

  $(document).ready(function() {
    $('#slider').slider();
  });


    $("#rotate").button().click(function(event) {
      event.preventDefault();
      $.each($('.ui-selected img'), function(i, image){
        $.post("/rotate", { image : $(image).attr("data-path")}, function(image) {
          image = JSON.parse(image);
          if (image.path) {
            $("img[data-path='"+ image.path +"']").attr("src", image.path + "?" + Date.now());
          }
        });
      });
    });

    $("#drop_box").selectable();

    $("#slider").slider({
      min: 100,
      max: 1000,
      slide: function( event, ui ) {
        $('#amount').val( ui.value );
        var width = ui.value;
        $.each($('.image_box img'), function(i, el){
          if($(el).attr('data-max-width') > width) {
            $(el).attr('width', width);
            $(el).attr('height', ($(el).attr('data-max-height')/$(el).attr('data-max-width')) * width);
          }
        });
      }
    }); 
  });

    function updateImage(image) {
      $("#drop_box").prepend("<div class='image_box'><img src='"+image.path+"' data-path='"+image.path+"' data-max-width='"+image.width+"' data-max-height='"+image.height+"' /></div>");
    }
